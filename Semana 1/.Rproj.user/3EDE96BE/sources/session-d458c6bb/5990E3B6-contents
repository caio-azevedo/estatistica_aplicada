# Importação dos pacotes necessários
import pandas as pd #manipulação de dados em formato de dataframe
from scipy.stats import chi2_contingency #estatística qui-quadrado
from scipy.stats.contingency import association #medidas de associação
import matplotlib.pyplot as plt #biblioteca de visualização de dados
import seaborn as sns #biblioteca de visualização de informações estatísticas
import numpy as np #biblioteca para operações matemáticas multidimensionais
from scipy.stats import pearsonr #cálculo da correlação de Pearson

# Carregamento da base de dados 'PlanoSaude'
df = pd.read_csv('cia_MB.csv', delimiter=';', decimal = ",")

# Visualização da base de dados 'PlanoSaude'
df_ciaMB

print("Formato (linhas, colunas):", df_ciaMB.shape)
print("\nTipos das colunas:\n", df_ciaMB.dtypes)
print("\nPrimeiras linhas:\n", df_ciaMB.head())
print("\nValores ausentes por coluna:\n", df_ciaMB.isna().sum())

tab_abs = pd.crosstab(df['Y'], df['V'], margins=True, margins_name='Total')
tab_prop_all = pd.crosstab(df['Y'], df['V'], normalize='all').round(3)
print(tab_abs)
tab_prop_row = pd.crosstab(df['Y'], df['V'], normalize='index').round(3)
print(tab_prop_row)
tab_prop_col = pd.crosstab(df['Y'], df['V'], normalize='columns').round(3)

ax = tab_prop_row.plot(kind='bar', stacked=True)
ax.set_xlabel("Grau de Instrução (Y)")
ax.set_ylabel("Proporção")
ax.legend(title="Região (V)", bbox_to_anchor=(1.05, 1), loc='upper left')
plt.tight_layout()
plt.show()


# Tabela de contingência para as variáveis 'operadora' e 'satisfacao'
# Tabela completa com soma nas linhas e colunas
tabela_completa = pd.crosstab(df_ciaMB['Y'], df_ciaMB['V'], margins=True)
tabela_completa

# Tabela de contingência propriamente dita
tabela_conting = pd.crosstab(df_ciaMB['Y'], df_ciaMB['V'])
tabela_conting

# Medida de associação - estatística qui-quadrado e teste
chi2, pvalor, df, freq_esp = chi2_contingency(tabela_conting)
pd.DataFrame({'Qui-quadrado':[chi2], 'Graus de liberdade':[df],'p-value':[pvalor]})

# Resíduos da tabela de contingência
residuos = tabela_conting - freq_esp
residuos
